# Pooling

## 배운 내용

- **Polling은 API을 연속으로 보낼 수 없을 때(ie. rate limiting) 사용된다.**
- **Polling은 구현이 간단하지만, 서버 부하와 네트워크 비용 증가 문제가 있다.**

## 상세 정리

보통 풀링을 하는 이유는 API를 연속으로 보낼 수 없기 때문에 발생한다

예를들어, 요청하는 API가 rate limiter를 걸어놓은 경우 몇초에 한번씩 요청가능한 경우가 있다. 그럴 때는 풀링을 사용해야 한다.

### 장점

일단 구현이 간단하다. 그냥 주기적으로 API를 요청하면 된다.

또한 웹훅처럼 이벤트 리스너 없이 클라이언트가 바로 API를 주기적으로 요청하면 된다

### 단점

한 사용자가 주기적으로 API를 요청하면 문제가 안되지만. 여러 사용자가 주기적으로 API를 요청하면 결국 디도스 공격이 된다. 즉, 트래픽, cpu, 네트워크 리소스를 소모하게 된다. (이때는 rate limiter나 caching을 해야하는 추가 리소스가 소모된다)

또한 동기적으로 업데이트가 불가능하다. 그래서 웹훅, 웹소켓 등의 이벤트를 전달하는 방법도 있다.

주기를 너무 짧게 가져가면 안된다

요청을 불필요하게 짧은 주기로 보내지 않는다. 주기적으로 짧게 요청하면 네트워크 비용이 증가할 수 밖에 없다

그렇다면 주기를 너무 길게 가져가도 안된다

만약 5초 주기로 요청을 보낼 때, 사용자가 4.9초에서 결제가 승인 안되다가 5.1초에서 승인이 나게되면 사용자는 4.9초 동안을 기다려야한다. 사용자 경험에 좋지 않게 된다

### 대체제

1. 웹훅

보통 이런 API들은 웹훅을 제공한다. 그러면 polling 없이 동기적으로 상태변경을 할 수 있다

2. 롱풀링

혹은 롱 풀링을 사용한다. 롱풀링은 클라이언트와 서버가 연결을 유지한채 응답을 보낸다. http 통신이라 편하지만 연결이 끊어지면 다시 요청해야 하므로 실시간 대체는 어렵다.

3. 웹소켓

웹소켓은 클라이언트와 서버간 양방향 통신을 유지한다. 하지만 연결을 지속적으로 유지해야 하므로 관리가 필요하다

## 회고 & 적용할 것

- **Polling을 언제 사용하는 것이 좋을까?**
    - 웹훅을 사용할 수 없는 API에서 상태 확인이 필요할 때
    - 즉각적인 응답이 필요하지 않고 일정 주기로 확인해도 되는 경우
- **어디에 적용할 수 있을까?**
    - 결제 승인 상태 확인
    - 대기열(queue) 상태 확인
    - 비동기 처리된 작업 결과 확인
- **추가로 공부할 것?**
    - Webhook과 WebSocket의 차이점
    - Long Polling의 장점과 단점
    - Polling 최적화 방법 (예: 지수 백오프 Exponential Backoff)